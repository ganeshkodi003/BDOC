<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org" th:fragment="summary">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Include jQuery UI -->
<link rel="stylesheet"
	href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>


<script src="js/bootstrap411.js"></script>
<link rel="stylesheet" href="css/spur.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js@latest"></script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>





<style>
.btn {
	line-height: 0.5rem;
}

.table-bordered td, .table-bordered th {
	font-size: smaller;
}

.container-manager {
	width: 83.5%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: 17.3%;
	margin-top: 80px;
	margin-top: 80px;
}

.table .thead-light th {
	color: #495057;
	background-color: #e9ecef;
	border-color: #dee2e6;
	width: 23px;
}

#thanveerssss {
	font-size: 30px;
}

.tablinks {
	background-color: #f2f2f2;
	color: #000;
}

/* Highlighted tab style */
.tablinks.active {
	background-color: #007bff;
	/* Change this to your desired highlight color */
	color: #fff; /* Change this to the text color for highlighted tabs */
}

.tab {
	overflow: hidden;
	border: 1px solid #ccc;
	background-color: #f1f1f1;
}

.scroll {
	max-height: 60vh;
	overflow-y: scroll;
	overflow-x: hidden;
}
/* Style the buttons inside the tab */
.tab button {
	background-color: inherit;
	float: left;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 14px 16px;
	transition: 0.3s;
	font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
	background-color: #ddd;
}

/* Create an active/current tablink class */
/* .tab button.active {
	background-color: #ccc;
} */

/* Style the tab content */
.tabcontent {
	display: none;
	padding: 6px 12px;
	border: 0px solid #ccc;
	border-top: none;
}

#myPieChart {
	width: 100px;
	height: 100px;
}

input, #address, select {
	border-radius: 10px;
	padding: 8px;
	width: 300px;
	border: 1px solid black;
}
</style>


<script>
	// JavaScript function to switch between tabs

	function Home() {

		location.href = 'Dashboard';
	}

	function Back() {
		window.history.back();
	}
	
	
</script>
<script>
	$(function() {
		$("#payDate,#dateofSalary").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat: 'dd-mm-yy',

		});
	});
	
	function getLastDate() {
		const month = document.getElementById('batchmon').value;
		const year = document.getElementById('batchyear').value;

		// Check if month and year are selected
		if (month && year) {
			const lastDay = new Date(year, month, 0).getDate(); // Get the last day of the selected month
			const lastDateFormatted = lastDay + '-' + month + '-' + year;
			const recordValue = year + month.padStart(2, '0');
			const recordValues = year + month.padStart(2, '0');
			document.getElementById('dateofSalary').value = lastDateFormatted;
			document.getElementById('payDate').value = lastDateFormatted;
			// Pad the month with '0' if necessary
			document.getElementById('record').value = recordValue;
			document.getElementById('records').value = recordValues;
		
		}
	}
	var selectedValue
	function handleSelectionChange(selectElement) {
	    // Alert to indicate the function is executed
	    alert("huhu");

	    // Get the selected value directly from the function argument
	  selectedValue = selectElement.value;
	    
	    // Alert the selected value (for debugging purposes)
	    alert(selectedValue);

	    // Perform AJAX request
	 
	}
	
	var g;
	function mail() {
		alert("Hello");
		var a = document.getElementById("pdf").value;
		alert(a);
		var d = document.getElementById("emp_no").value;
		alert(d);

		var t = g;
		alert(t);

		$.ajax({
			url : './payslipgenerationemail',
			data : {
				a : a,
				d : d,
				t : t
				
			// Correct assignment of t to the data object
			},
			type : 'POST',
			success : function(data) {
				alert(data);
			}
		});
	}

	function ssss(event) {
		alert("ghjk");
		//  handleFileSelect();
		// Call handleFileSelect and alert the returned message
		var a = handleFileSelect(event);
		alert("fghjkl;" + a);
		g = a;

	}	
	function handleFileSelect(event) {
		const files = event.target.files; // Access the array of selected files
		let message = ""; // Initialize message variable

		if (files && files.length > 0) {
			// Iterate through each selected file
			for (let i = 0; i < files.length; i++) {
				const file = files[i];
				const fileName = file.name; // Get the file name

				// Append the file name to the message
				message += `${fileName}\n`;
			}

			// Show the message in an alert
			alert("Selected files:\n" + message);

			// You can further process each file as needed here
		} else {
			message = "No files selected."; // Update message if no files are selected
			console.log(message);
			alert(message);
		}
		// Return the message if needed outside the function
		return message;
	}

	function generate() {
	    alert("Generate-Payslip");

	    // Get selected reference numbers
	    var selectedRefs = [];
	   

	    // Get other values
	
	    var a = document.getElementById('record').value;
	    alert(a);
	    var t = document.getElementById('emp_no').value;
	    alert(t);
	   
	    var file = "pdf";
	    location.href = './payslipgeneration?filetype=' + file + '&a=' + a + '&t=' + t;

	   
	}
	
	function generates(){
		alert("demo")
		var selectedRefs = [];
		var selectElement = document.getElementById('emp_no');

		// Check if selectElement exists
		if (selectElement) {
		    console.log(selectElement);

		    // Loop through options
		    for (var i = 0; i < selectElement.options.length; i++) {
		        var option = selectElement.options[i];
		        
		        // Check if option is selected and not empty
		        if (option.selected && option.value !== "") {
		            selectedRefs.push(option.value);
		        }
		    }

		    // Serialize list into a comma-separated string
		    var serializedRefs = selectedRefs.join(",");
		    
		    // Log the serialized references
		    console.log("Serialized References: " + serializedRefs);

		    // Alert the serialized references
		    alert(serializedRefs);
		} else {
		    console.log("Element with ID 'emp_no' not found.");
		}

	}

	function handleSelectionChange(selectElement) {
		alert("huhu");
		var selectedValue = selectElement.value; // Get the selected value directly from the function argument
		alert(selectedValue);
	}

</script>


</head>



<body>

	<div class="col-sm-2">
		<div th:insert="BTMHeaderMenu :: header"></div>
	</div>
	<!---------------------User List Starts------------------------------------------------------->
	<!-- Start Content-->
	<div class="container-manager">



		<div class="row">


			<div class="col-sm-11"
				style="font-size: 12px; margin-left: 50px; margin-top: 0px;">


				<!--<div class="content">-->
				<div>
					<div class="card">
						<div 
							style="padding: 10px 0px 0px 10px; background-color: #e9ecef;">
							

							<h4
								style="height: 40px;">
								BATCH JOB-Monthly PaySlip Generation</h4>
						</div>
						<div class="card-body" >

							<div class="row formline">
									<div class="col-sm-2">
										<h5>Month</h5>
									</div>
									<div class="col-sm-1" >
										<select name="" id="batchmon" style="width: 100px;"
											class="form-control" onchange="getLastDate()">
											<option value="">Month</option>
											<option value="01">JAN</option>
											<option value="02">FEB</option>
											<option value="03">MAR</option>
											<option value="04">APR</option>
											<option value="05">MAY</option>
											<option value="06">JUNE</option>
											<option value="07">JULY</option>
											<option value="08">AUG</option>
											<option value="09">SEP</option>
											<option value="10">OCT</option>
											<option value="11">NOV</option>
											<option value="12">DEC</option>
										</select>
									</div>
									<div>
										<select name="" id="batchyear"
											style="width: 100px; margin-left: 7px;" class="form-control"
											onchange="getLastDate()">
											<option value="">year</option>
											<option value="2017">2017</option>
											<option value="2018">2018</option>
											<option value="2019">2019</option>
											<option value="2020">2020</option>
											<option value="2021">2021</option>
											<option value="2022">2022</option>
											<option value="2023">2023</option>
											<option value="2024">2024</option>
											<option value="2025">2025</option>
											<option value="2026">2026</option>
											<option value="2027">2027</option>
											<option value="2028">2028</option>
											<option value="2029">2029</option>
										</select>
									</div>



								</div>
							<br>
							<div class="row formline">
								<div class="col-sm-2">
									<h5>Date Of Salary</h5>
								</div>
								<div class="col-sm-2">
									<input type="text" class="form-control form-control-sm" name="dateofSalary"
										id="dateofSalary" placeholder="DD-MM-YYYY">
								</div>


							</div>
							<br>
							<div class="row formline">
								<div class="col-sm-2">
									<h5>Payment Date</h5>
								</div>
								<div class="col-sm-2">
									<input type="text" class="form-control form-control-sm" name="payDate"
										id="payDate" placeholder="DD-MM-YYYY">
								</div>


							</div>
							
							<br>
							<div class="row formline">
								<div class="col-sm-2">
									<h5>Assosiate ID</h5>
								</div>
								<div class="col-sm-2">
								<select name=emp_no id="emp_no" class="form-control form-control-sm"
										onchange="handleSelectionChange(this)" placeholder="select">
										<option th:selected="${empty == ''}" value="">select</option>
										<option th:each="ref : ${cvfverify}" th:value="${ref}"
											th:text="${ref}">ref</option>




									</select>
									</div>
								
								<div class="col-sm-2">
										<input type="text" class="form-control form-control-sm"
											name="record" id="record" value="" placeholder="DD-MM-YYYY"
											hidden />
									</div>
									
									<div class="col-sm-2">
										<input type="text" class="form-control form-control-sm"
											name="demoid" id="demoid" 
											hidden />
									</div>


							</div>
						<div class="row formline">
								<div class="col-sm-2">
									<h5>Choose File</h5>
								</div>
								<div class="col-sm-2">
												
									<input type="file" id="pdf"  name="pdf"  class="form-control form-control-sm"  onchange="ssss(event)">
										 </div>

											</div>
											

											
										</div>
								


						</div>

						<div class="card-footer text-center"
							style="background-color: #e9ecef">


							<button class="btn btn-primary" onclick="Home();">Home</button>
							<button class="btn btn-primary" onclick="generate()">Generate</button>
							<button class="btn btn-primary" onclick="mail()">Email</button>
							<button class="btn btn-primary" onclick="Back();">Back</button>

						</div>
					</div>
				</div>

			</div>



		</div>
	</div>


</body>
</html>