<!--<p>COMPLETED BY MOHAMED SALIK.A.S</p>-->

<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>

<style>

.btns {
	float: right;
	margin: 5px;
}

.col-sm-5 {
	padding-bottom: 15px;
}

.list-body {
	padding: 0px;
}

.error {
	color: red;
	padding-left: 10px;
}

.formline {
	padding-bottom: 4px;
}

#finusertb {
	width: 460px;
}

.dataTables_wrapper .dataTables_paginate .paginate_button {
	padding: 0px;
}

label {
	font-size: 13px;
}

fieldset {
	border: 1px solid #CCC;
	border-radius: 5px;
	padding: 10px;
	margin-top: 10px;
}


</style>

<script>
$(document).ready(function(){
	$('.mant').css('color', '#fbe4d2');
	//$('.form-control').attr("disabled", true);
if("admin"=='<%=request.getParameter("types")%>'){
		
	$("#tab_logic").attr("readonly", true);
		
	}if("inquiries"=='<%=request.getParameter("types")%>'){
		
		$("#btnhome,#btnback").show();
		$("#btnadd").hide();
		
	}

	$( "#btnmodify" ).click(function() {
		$('.mant').css('color', 'red');
		$('.form-control').attr("disabled", false);
		$( "#btnmodify" ).hide();
		
		
		});
	$( "#btnhome" ).click(function() {
		location.href = "BTMHomePage.jsp";
		
		});
	
	$( "#btnback" ).click(function() {
		
		 window.history.back();
		});
	if("maintenance"=='<%=types%>'){
		$("#btnapp").show();
		$("#btnmod").hide();
	}
	
	if("admin"=='<%=request.getParameter("types")%>'){
		$('.form-control').attr("disabled", true);
		
		$("#btnmod").hide();
	}
	if("inquiries"=='<%=request.getParameter("types")%>'){
		$('.form-control').attr("disabled", true);
		
		$("#btnmod").hide();
	}
});
</script>
<script th:inline="javascript">
	
		
	$(function() {

		$("#date").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd-mm-yy"
		});
		});
		
			$(function() {
	
		$("#date1").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd-mm-yy"
		});
	});
	
	
	
			function editsubmit(a){
				var empid = a.getAttribute("data-empid");
	var month =   a.getAttribute("data-month");
	var year = a.getAttribute("data-year");
	
		location.href="./timeSheet?formmode=modify"+'&emp_id='
			+ empid + '&year=' + year + '&month='
			+ month;
		
			}
			   function getdatemonthly(){
	
            var dt = new Date();
            var month = dt.getMonth();
            var year = dt.getFullYear();
            var Days = getDayNamesInMonth(month, year);
         
            fetch = document.getElementById('timesheet');
            for (var i = 0; i < Days.length; i++) 
			{
			
                var newRow = fetch.insertRow(fetch.length);
                var Datecell = newRow.insertCell(0);
                var Daycell = newRow.insertCell(1);
                var login_time = newRow.insertCell(2);
                var logout_time = newRow.insertCell(3);
                var hours = newRow.insertCell(4);
                var job_type = newRow.insertCell(5);
                var job_description = newRow.insertCell(6);
                var holidat = newRow.insertCell(7);
                Datecell.innerHTML = `${i + 1}-${month + 1}-${year}`;
                Daycell.innerHTML = `${Days[i]}`
               

            }

            function getDayNamesInMonth(month, year) {
                let date = new Date(year, month, 1);
                let days = [];
                while (date.getMonth() === month) {
                    days.push(new Date(date).toLocaleDateString('en-US', { weekday: 'short' }));
                    date.setDate(date.getDate() + 1);
                }
                return days;
            }
            
         }  
         
         
         	//Filter Table

	$(document)
			.ready(
					function() {
						$('.filterable .btn-filter')
								.click(
										function(event) {
											event.preventDefault();
											var $panel = $(this).parents(
													'.filterable'), $filters = $panel
													.find('.filters input'), $tbody = $panel
													.find('.table tbody');
											if ($filters.prop('disabled') == true) {
												$filters
														.prop('disabled', false);
												$filters.first().focus();
											} else {
												$filters.val('').prop(
														'disabled', true);
												$tbody.find('.no-result')
														.remove();
												$tbody.find('tr').show();
											}
										});

						$('.filterable .filters input')
								.keyup(
										function(e) {
											/* Ignore tab key */
											var code = e.keyCode || e.which;
											if (code == '9')
												return;
											/* Useful DOM data and selectors */
											var $input = $(this), inputContent = $input
													.val().toLowerCase(), $panel = $input
													.parents('.filterable'), column = $panel
													.find('.filters th')
													.index($input.parents('th')), $table = $panel
													.find('.table'), $rows = $table
													.find('tbody tr');
											/* Dirtiest filter function ever ;) */
											var $filteredRows = $rows
													.filter(function() {
														var value = $(this)
																.find('td').eq(
																		column)
																.text()
																.toLowerCase();
														return value
																.indexOf(inputContent) === -1;
													});
											/* Clean previous no-result if exist */
											$table.find('tbody .no-result')
													.remove();
											/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
											$rows.show();
											$filteredRows.hide();
											/* Prepend no-result row if all rows are filtered */
											if ($filteredRows.length === $rows.length) {
												$table
														.find('tbody')
														.prepend(
																$('<tr class="no-result text-center"><td colspan="'
																		+ $table
																				.find('.filters th').length
																		+ '">No result found</td></tr>'));
											}
										});
					});
					
	
	
	function home() {
	location.href = 'Dashboard'
	}
				
	function back() {
	window.history.back();
	}
	function AddCurrent(){
		location.href = './timeSheet?formmode=add';
	}
	function Add() {
		alert("hi")
		$.ajax({
					url: "./getMonthYear",
					dataType: 'json',
					type: 'get',
					async: true,
					success: function (res) {
 var a = new Date();
				var u = a.getMonth()+1;
				var m = parseInt(u);
				var y =a.getFullYear();
			
				var y =a.getFullYear();
				var datamonth=res.month;
				var datayear=res.year;
				if(u==12){
				var	n = "0";
				var	n1 = n + 1;
				
				}else if(u<=8){
					var	n = "0";
				var	n1 = n + u;
				}else{
					var n1=u+1;
				}
				if( datamonth!=n1 && y!=datayear|| y==datayear && datamonth!=n1){
					$('#alert1').modal("toggle");
	}
	
	},
	error : function() {
              
			location.href="./timeSheet?formmode=addnew";
				}
				
            })
           
	}
	
	 function addnew(){
		 alert("hihi")
				location.href="./timeSheet?formmode=addnew";
				
			}
	$(document).ready(
    		  
    		  /* This is the function that will get executed after the DOM is fully loaded */
    		  function () {
var monthNames = ["January", "February", "March", "April", "May", "June",
							"July", "August", "September", "October", "November", "December"
						];

  var y = (new Date()).getFullYear();
  var m = (new Date()).getMonth();
  if (m == 12) {

							m = 0;

							m1 = m + 1;
							y = y + 1;
							var mnthval = "0" + m1;

							$('#dropdownMonth').append('<option value="' + mnthval + '">' + monthNames[m] + '</option>');

							$('#dropdownYear').append('<option value="' + y + '">' + y + '</option>');
						}
						if(m<=8){
							m1=m+1;
				var mnthval = "0" + m1;
				$('#dropdownMonth').append('<option value="' + mnthval + '">' + monthNames[m] + '</option>');

				$('#dropdownYear').append('<option value="' + y + '">' + y + '</option>');
				}else{
					m1=m+1;
					$('#dropdownMonth').append('<option value="' + m1 + '">' + monthNames[m] + '</option>');

				$('#dropdownYear').append('<option value="' + y + '">' + y + '</option>');
				}
						
					
					
})

	function Yes(){
		location.href="./timeSheet?formmode=Yes";
	}
</script>

 <script>
    var p=0;
    function funcal(a){
    
    	var ids=a.match(/\d+/);
    
    	var v=ids;
    	$('.form-control ').on('change', function() {
  var start = new Date("01-11-2000 " + $('#timein'+v).val())
  var end = new Date("01-11-2000 " + $('#timeout'+v).val());
  
  var diff = new Date(end - start).toISOString(); // "yyyy-mm-ddThh:mm:ss.zzzZ"
  var hms = diff.match(/T([\d:]+)\./)[1].split(':'); // Get time and split by `:`
  
  $('#hours'+v).val( hms[0] +':'+ hms[1] ); // Use hours [0] and minutes [1] 

});

		var h = ids - 1;
		var j = ('0' + 1).slice(-2);
			var mn = document.getElementById('month').value;
			var yr = document.getElementById('year').value;
		 var a = new Date(mn+"-"+h+"-"+yr);
		 var day=weekday[a.getDay()];
		if(day=="Sunday"){
			var h =ids-3;
		if ($("#timein" + h).val() == "") {

			alert("Select Previous date Time in");
			
		} else if ($("#timeout" + h).val() == "") {
			alert("Select Previous date Time out");

		} else if ($("#target" + h).val() == "") {
				alert("Enter Previous date Job Type");
				$("#target" + h).focus();
			
		} else if ($("#jobdes" + h).val() == "") {
				alert("Enter Previous date Job Description");
				$("#jobdes" + h).focus();
			}
		}else if(day=="Friday"){
			
		}else {
			if($("#timein" + h).val() == "") {

			alert("Select Previous date Time in");
			
		} else if ($("#timeout" + h).val() == "") {
			alert("Select Previous date Time out");

		} else if ($("#target" + h).val() == "") {
				alert("Enter Previous date Job Type");
				$("#target" + h).focus();
			
		} else if ($("#jobdes" + h).val() == "") {
				alert("Enter Previous date Job Description");
				$("#jobdes" + h).focus();
			}
		}
    
	}

    $(document).ready(
    		  
    		  /* This is the function that will get executed after the DOM is fully loaded */
    		  function () {
    		    $("#dateofapp,#dateofsub").datepicker({
    		    	
    		    	dateFormat: 'dd-mm-yy',
    		      changeMonth: true,
    		      changeYear: true 
    		    });
    		    
    		   
    	 	  }); 
    </script>
    <script>
    
var arr1=[];
var uniqueDate = [];
    $(document).ready(
    		  
    		  /* This is the function that will get executed after the DOM is fully loaded */
    		  function () {
    			  arr1.length=0;
    			  uniqueDate.length=0;
    			   var empid = document.getElementById('emp_id').value;
			var month = document.getElementById('month').value;
			var year = document.getElementById('year').value;
    var resid = {
			"resid": empid, "month": month, "year": year ,
			
		}; 
		 $.ajax({
			 url : "./timedetails",
			data : resid,
			dataType : 'json', 
			type : 'GET',
			async : true,
			 success : function(res) {
				 console.log(JSON.stringify(resid))
				var j = ('0' + 1).slice(-2);
				var mn = month;
					var yr = year;
				var dayval="";
				var nod=parseInt(daysInMonth(month,year));
				
				var k=0;
				var DateArr ="";
				var leavearr="";
				for(var i=0;i<nod;i++){
					dayval=res[i];
					if(res==',,,,,,,,,,,,,,,,,,,,,,,,,,,,,,'){
						dayval="||||||||||||||";
					}
					 var a = new Date(mn+"-"+('0' +j).slice(-2)+"-"+yr);
					
	
$('#tab_logic').append("<tr><td><input class=form-control  readonly  input-md name='date_"+(i+1)+"' id='d"+(i+1)+"'  type=text onkeypress=document.getElementById(k-1)  value='"+('0' +j).slice(-2)+"-"+mn+"-"+yr+"' style=width:125px; readonly class=form-control input-md /></td><td><input  type=text id='d"+(i+1)+"'name='date_"+(i+1)+"'  readonly  style=width:120px; class=form-control input-md value='"+weekday[a.getDay()]+"' readonly> </td><td><input  type=time id='timein"+(i+1)+"' name='date_"+(i+1)+"'   style=width:130px;  value='"+dayval.split("||")[2]+"' class=form-control input-md onclick=funcal('timein"+(i+1)+"'); ></td><td><input  id='timeout"+(i+1)+"'  name='date_"+(i+1)+"' style=width:130px; type=time   class=form-control   input-md value='"+dayval.split("||")[3]+"' onclick=funcal('timeout"+(i+1)+"'); ></td><td><input  name='date_"+(i+1)+"' id='hours"+(i+1)+"' readonly type=text   style=width:90px; class=form-control input-md value='"+dayval.split("||")[4]+"'></td><td><input   name='date_"+(i+1)+"'  type=text id='target"+(i+1)+"'  class= form-control  ch1 input-md value='"+dayval.split("||")[5]+"'  onkeypress='jtype("+(i+1)+")'></td><td><input  name='date_"+(i+1)+"' type=text   id='jobdes"+(i+1)+"' class=form-control ch1 input-md value='"+dayval.split("||")[6]+"'   onkeypress='jtype("+(i+1)+")'></td><td><input  name='date_"+(i+1)+"'   type=text id='holiday"+(i+1)+"'  class=form-control input-md value='"+dayval.split("||")[7]+"'      onkeypress='jtype("+(i+1)+")'></td></tr>");
var myStr =$("#jobdes"+(i+1)).val();
 var newStr = myStr.replace(/~/g, ",");
 $("#jobdes"+(i+1)).val(newStr);
 
 var JobStr =$("#jobdes"+(i+1)).val();
 var Str = JobStr.replace(/`/g, "'");
 $("#jobdes"+(i+1)).val(Str);

 var myStr1 =$("#target"+(i+1)).val();
 var newStr1 = myStr1.replace(/~/g, ",");
 $("#target"+(i+1)).val(newStr1);
 
 var TypeStr1 =$("#target"+(i+1)).val();
 var Str1 = TypeStr1.replace(/`/g, "'");
 $("#target"+(i+1)).val(Str1);
 /* onkeypress='return /[0-9a-zA-Z]/i.test(event.key)' */
				 if(weekday[a.getDay()]=="Sunday"){
						
						$("#holiday"+(i+1)+"").val("YES");
						$("#timein"+(i+1)+"").val("00:00");
						$("#timeout"+(i+1)+"").val("00:00");
						$("#hours"+(i+1)+"").val("00:00");
						$("#target"+(i+1)+"").val("Nil");
						$("#jobdes"+(i+1)+"").val("Nil");
						$("#timein"+(i+1)+"").attr("readonly", true);
						 $("#timeout"+(i+1)+"").attr("readonly", true); 
						$("#target"+(i+1)+"").attr("readonly", true);
                 	$("#jobdes"+(i+1)+"").attr("readonly", true);
                 	$("#holiday"+(i+1)+"").attr("readonly", true);
					}
				 else if(weekday[a.getDay()]=="Saturday"){
						
						$("#holiday"+(i+1)+"").val("YES");
						$("#holiday"+(i+1)+"").attr("readonly", true);
					}
					else{
						$("#holiday"+(i+1)+"").val("NO");
						$("#holiday"+(i+1)+"").attr("readonly", true);
						
					} 
			 
								j++;
				
				}
				}
		 
				
	 }); 
		 
		
		 
		 $('#target').keypress(function() {
		        var dInput = this.value;
		        console.log(dInput);
		     // alert(dInput); 
		     
		    });
	 	/*  $("input[name='jobtype']").blur(function(){

		        var v = $(this).val();
		        alert(v); 
		     });  */
		 
    		  }); 
    		  
    function daysInMonth(month,year) {
        return new Date(year, month, 0).getDate();
        
    }
    
  
   
    
   
 
    function fnmod(a,b,c){
    	if(p==1)
		{
    		timesheetdetails.action="timesheetmod?method=modifytimesheet&resid="+a+"&month="+b+"&year="+c+"&dat="+uniqueDate;
    		timesheetdetails.submit(); 
		}
	else
		{
		alert("Please enter time sheet");
		}
	
	
    
    }
    
    function submitform(a) {
    	
					var mn = document.getElementById('month').value;
			var yr = document.getElementById('year').value;
	var nod=parseInt(daysInMonth(mn,yr));
		var h2 =nod;
		 var a = new Date(mn+"-"+h2+"-"+yr);
		 var day=weekday[a.getDay()];
		 var dateofsub = document.getElementById('modify_date_of_submission').value;
		 
		
		/*  var input1 = 1;
			while ($("#target"+input1).val() != '') {
				
				 var myStr1 =$("#target"+input1).val();
				 var newStr1 = myStr1.replace(/,/g, "~");
				 $("#target"+input1).val(newStr1);
				/*  var TypeStr1 =$("#target"+input1).val();
				 var Str1 = TypeStr1.replace(/"/g, "`");
				 $("#target"+input1).val(Str1); 
				 input1++;
				} */
		 if(dateofsub!=''){
		 if(day=='Sunday'){
			var h1=nod-2;
			if ($("#timein" + h1).val() == "") {

			alert("Select Previous date Time in");
			
		} else if ($("#timeout" + h1).val() == "") {
			alert("Select Previous date Time out");

		} else if ($("#target" + h1).val() == "") {
				alert("Enter Previous date Job Type");
				$("#target" + h1).focus();
			
		} else if ($("#jobdes" + h1).val() == "") {
				alert("Enter Previous date Job Description");
				$("#jobdes" + h1).focus();
			}
		}else if(day=='Saturday'){
			var h1=nod-1;
			if ($("#timein" + h1).val() == "") {

			alert("Select Previous date Time in");
			
		} else if ($("#timeout" + h1).val() == "") {
			alert("Select Previous date Time out");

		} else if ($("#target" + h1).val() == "") {
				alert("Enter Previous date Job Type");
				$("#target" + h1).focus();
			
		} else if ($("#jobdes" + h1).val() == "") {
				alert("Enter Previous date Job Description");
				$("#jobdes" + h1).focus();
			}
		}else if ($("#jobdes" + h2).val() == "") {
			alert("Enter Previous Time Sheet");
			$("#jobdes" + h2).focus();
			
		
		}
		}
			
		if(dateofsub!=''){
		
				var empid = document.getElementById('emp_id').value;
	var month =   document.getElementById('month').value;
	var year = document.getElementById('year').value;
	 var input = 1;
	 	while ($("#jobdes"+input).val() != '' && input<=nod) {
		
		 var myStr =$("#jobdes"+input).val();
		 var newStr = myStr.replace(/,/g, "~");
		 $("#jobdes"+input).val(newStr);
		 var JobStr =$("#jobdes"+input).val();
		 var Str = JobStr.replace(/"'"/g, "`");
		 $("#jobdes"+input).val(Str);
		 input++;
		} 
	 	 var input1 = 1;
		 	while ($("#target"+input1).val() != '' && input1<=nod) {
			
			  var myStr1 =$("#target"+input1).val();
			 var newStr1 = myStr1.replace(/,/g, "~");
			 $("#target"+input1).val(newStr1);
			  var JobStr =$("#target"+input1).val();
			 var Str = JobStr.replace(/"'"/g, "`");
			 $("#target"+input1).val(Str);  
			 input1++;
			} 
			 
				var url = "./timeSheetEdit?empid="+empid+'&month='+month+'&year='+year;

				$("#timeSheetmaster").attr('action', url);

				var options = {
					success: showResponse
				};

				$("#timeSheetmaster").ajaxSubmit(options);

				function showResponse(responseText, statusText, xhr, $form) {

					$("#alertmsg").text(responseText);
					$('#alert').modal({backdrop: 'static', keyboard: false}, 'show');
					$("#alert").modal("toggle");
				}
			}else
		 if ($("#timeSheetmaster").valid()) {
				var empid = document.getElementById('emp_id').value;
	var month =   document.getElementById('month').value;
	var year = document.getElementById('year').value;
	 var input = 1;
	 	while ($("#jobdes"+input).val() != '' && input<=nod) {
		
		 var myStr =$("#jobdes"+input).val();
		 var newStr = myStr.replace(/,/g, "~");
		 $("#jobdes"+input).val(newStr);
		 var JobStr =$("#jobdes"+input).val();
		 var Str = JobStr.replace(/'/g, "`");
		 $("#jobdes"+input).val(Str);
		 input++;
		} 
	 	 var input1 = 1;
		 	while ($("#target"+input1).val() != '' && input1<=nod) {
			
			  var myStr1 =$("#target"+input1).val();
			 var newStr1 = myStr1.replace(/,/g, "~");
			 $("#target"+input1).val(newStr1);
			  var JobStr =$("#target"+input1).val();
			 var Str = JobStr.replace(/'/g, "`");
			 $("#target"+input1).val(Str);  
			 input1++;
			} 
				var url = "./timeSheetEdit?empid="+empid+'&month='+month+'&year='+year;
				$("#timeSheetmaster").attr('action', url);

				var options = {
					success: showResponse
				};

				$("#timeSheetmaster").ajaxSubmit(options);

				function showResponse(responseText, statusText, xhr, $form) {

					$("#alertmsg").text(responseText);
					
					$('#alert').modal({backdrop: 'static', keyboard: false}, 'show');
					$("#alert").modal("toggle");
				}
			}
			
			
		};
 
    function diff(start, end) {
     	
         start = start.split(":");
        end = end.split(":"); 
        var startDate = new Date(0, 0, 0, start[0], start[1], 0);
        var endDate = new Date(0, 0, 0, end[0], end[1], 0);
        var diff = endDate.getTime() - startDate.getTime();
        var hours = Math.floor(diff / 1000 / 60 / 60);   
        diff -= hours * 1000 * 60 * 60;
         var minutes = Math.floor(diff / 1000 / 60); 
          
        return (hours < 9 ? "0" : "") + hours + ":" + (minutes < 9 ? "0" : "") + minutes;
    }
 
    	
    var weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
   


    var weekday=new Array(7);
    weekday[0]="Sunday";
    weekday[1]="Monday";
    weekday[2]="Tuesday";
    weekday[3]="Wednesday";
    weekday[4]="Thursday";
    weekday[5]="Friday";
    weekday[6]="Saturday";

    var d = new Date();
    var n = weekday[d.getDay()];

    
    </script>
 <script type="text/javascript">
    
    function jtype(k){
  	  
    	p=1;
  	  var dateid='d'+k;
  	 var jtid='target'+k;
  	 $("#did").val($("#"+dateid).val()+":"+$("#"+jtid).val());
  	var date= $("#did").val($("#"+dateid).val());
  	
  	 var dates=	 $("#"+dateid).val();
  	
  	
 	 arr1.push(dates);
 	
 	
 	$.each(arr1, function(i, el){
 	    if($.inArray(el, uniqueDate) === -1) uniqueDate.push(el);
 	});
 	
 	for(var i=0;i<uniqueDate.length;i++){
  		
  	}
 	
    }
   
   
	$(document).ready(function () {
			var resId = $('#add_employee_id').val();
				$.ajax({
					url: "./getMonthYear?resId=" + resId,
					dataType: 'json',
					type: 'get',
					async: true,
					success: function (res) {
 
						var monthNames = ["January", "February", "March", "April", "May", "June",
							"July", "August", "September", "October", "November", "December"
						];


						var m = parseInt(res.month);
						var y = res.year;
						
						if (m == 12) {

							m = 0;

							m1 = m + 1;
							y = y + 1;
							var mnthval = "0" + m1;

							$('#month').append('<option value="' + mnthval + '">' + monthNames[m] + '</option>');

							$('#year').append('<option value="' + y + '">' + y + '</option>');
						}
						if(m<=8){
							m1=m+1;
				var mnthval = "0" + m1;
				$('#month').append('<option value="' + mnthval + '">' + monthNames[m] + '</option>');

				$('#year').append('<option value="' + y + '">' + y + '</option>');
				}else{
					m1=m+1;
					$('#month').append('<option value="' + m1 + '">' + monthNames[m] + '</option>');

				$('#year').append('<option value="' + y + '">' + y + '</option>');
				}
						
					}
				})
		});
function addbutton(){
	if(document.getElementById('addnew').value=="null"){
		$("#addNew").show();
	}else{
		$("#addNew").hide();
	}
}
$(function() {

	$("#modify_date_of_approval").datepicker({
		changeMonth : true,
		changeYear : true,
		maxDate :  Date(),
		dateFormat : "dd-mm-yy",
        viewMode: "months"
	});

	var today = new Date();
	var dd = today.getDate();
	var mm = today.getMonth() + 1; //January is 0!

	var yyyy = today.getFullYear();
	if (dd < 10) {
		dd = '0' + dd;
	}
	if (mm < 10) {
		mm = '0' + mm;
	}
	var today = dd + '-' + mm + '-' + yyyy;
	document.getElementById('modify_date_of_approval').value;
}); 
$(function() {
	

	$("#modify_date_of_submission").datepicker({
		changeMonth : true,
		changeYear : true,
		maxDate : new Date(),
		dateFormat : "dd-mm-yy",
        viewMode: "months"
	});

	var today = new Date();
	var dd = today.getDate();
	var mm = today.getMonth() + 1; //January is 0!

	var yyyy = today.getFullYear();
	if (dd < 10) {
		dd = '0' + dd;
	}
	if (mm < 10) {
		mm = '0' + mm;
	}
	var today = dd + '-' + mm + '-' + yyyy;
	document.getElementById('modify_date_of_submission').value;
}); 


 /*$(function () {
	 alert("hihji")
            // Initialize the date picker
            $("#modify_date_of_submissionss").datepicker({
                dateFormat: 'dd-mm-yy',
                changeMonth: true,
                changeYear: true,
                yearRange: '1900:+1', // You can adjust the year range as needed
                onClose: function (selectedDate) {
                    // When a date is selected, update the max date based on the selected month
                    var selectedMonth = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                    var selectedYear = $("#ui-datepicker-div .ui-datepicker-year :selected").val();

                    // Calculate the last day of the selected month
                    var lastDay = new Date(selectedYear, selectedMonth + 1, 0).getDate();

                    // Set the max date
                    $(this).datepicker("option", "maxDate", selectedYear + "-" + (selectedMonth + 1) + "-" + lastDay);
                }
            });
        });*/
function fnadd(){
	
	if ($("#timeSheetmaster1").valid()) {
		var url = "./timeSheetAdd?";
		$("#timeSheetmaster1").attr('action', url);

		var options = {
			success: showResponse
		};

				$("#timeSheetmaster1").ajaxSubmit(options);

				function showResponse(responseText, statusText, xhr, $form) {

					$("#alertmsg").text(responseText);

					$('#alert').modal({backdrop: 'static', keyboard: false}, 'show');
					$("#alert").modal("toggle");
				}
			}
		
			     };
			     
			     
			      window.onload = function() {
            // Get the current date
            var currentDate = new Date();

            // Get the day of the month
            var dayOfMonth = currentDate.getDate();

            // Get the submission input field
            var submissionInput = document.getElementById('modify_date_of_submission');

            // Check if the day is 31 and if the month is January (month is 0-based in JavaScript)
            if (dayOfMonth === 31 && currentDate.getMonth() === 0) {
                // Enable editing for the input field
                submissionInput.removeAttribute('readonly');
            } else {
                // Make the input field readonly
                submissionInput.setAttribute('readonly', 'readonly');
            }
        };


		function popupscreen() {
            const today = new Date();
            const month = today.getMonth() + 1; // Months are zero-based in JavaScript
            const year = today.getFullYear();

            // Create a new date for the first day of the next month, then subtract one day
            const lastDayOfMonth = new Date(year, month, 0);
            const day = lastDayOfMonth.getDate();

            const formattedDate = `${day.toString().padStart(2, '0')}-${month.toString().padStart(2, '0')}-${year}`;
            alert(`${formattedDate} is Date of Submission For this Month`);
        }

    </script>
</head>
<title>BTM</title>
<body onload="addbutton()">
<!-- <-----------------------------------------------------------TimesheetList-------------------------------------------------------------------------->
	<div class="container-fluid">
		<div class="row">

	<div class="col-sm-2">
				<div th:insert="BTMHeaderMenu :: header"></div>
			</div>
			<div class="col-sm-10">

				<div class="container-fluid"
					th:if="${formmode}=='list' OR ${formmode}=='list1'">
					<div class="row">
						<div class="col-sm-12">
							<div class="container-fluid content">
								<div class="row">
									<div class="card w-100">
										<div class="card-body p-0">
											<div class="panel panel-primary filterable">
												<div class="card-header d-flex justify-content-between"style="background-color:#BBC3CB;">
													<h4>TIMESHEET LIST</h4>
												</div>
												<div class="table-responsive">
													<table class="table table-bordered" th:if="${formmode}=='list'">
												<thead>
													<tr>
														<th>Year</th>
														<th>Month</th>
														<th>Emp ID</th>
														<th>Emp Name</th>
														<th>Project Name</th>
														<th>Client Name</th>
														<th>Report Manager</th>
														<th>Approval Authority</th>
														<th>Status</th>
														<th>Select</th>
													</tr>
												</thead>
												<tbody >
													<tr th:each="timeSheet : ${TimesheetList}">
																<td id="addnew"th:text="${timeSheet?.year}"></td>
																<td th:text="${timeSheet?.month}"></td>
																<td th:text="${timeSheet?.emp_id}"></td>
																<td th:text="${timeSheet?.emp_name}"></td>
																<td th:text="${timeSheet?.proj_name}"></td>
																<td th:text="${timeSheet?.client_name}"></td>
																<td th:text="${timeSheet?.rpt_mrg}"></td>
																<td th:text="${timeSheet?.apr_auth}"></td>
																<td>Pending</td>
														<td><input th:if="${formmode}=='list'"
																	class="form-control-md checkToView" onclick="editsubmit(this);"
																	th:attr="data-empid=${timeSheet?.emp_id},data-year=${timeSheet?.year},data-month=${timeSheet?.month}"
																	th:value="${timeSheet?.emp_id}" type="radio" /></td>
													</tr>
												</tbody></table>
												</div>
											</div>
										</div>
										
										<div class="card-footer text-center"style="background-color:#BBC3CB;">
											<button type="button" class="btn btn-primary" id="btnHome"
												onclick="home()">Home</button>
												<button type="button" class="btn btn-primary" id="addNew"
												onclick="Yes()">Add New</button> 
											<button type="button" class="btn btn-primary" id="btnBack"
												onclick="back()">Back</button>  
										</div>
									</div>

								</div>
										</div>
						</div>
					</div>
				</div>
				
<!-- --------------------------------------------	Employee Details ------------------------------------------------------------ -->
				<div class="container-fluid content" th:if="${formmode}=='modify'">
					<div class="row">
						<div class="col-sm-12 finuserapply">
							<form action="#" th:object="${TimesheetList}" method="POST"
								class="w-100" autocomplete="off" id="timeSheetmaster">
								<div class="card">
									<div class="card-header"style="background-color:#BBC3CB;">
										<div class="float-left">
											<h3>TIME SHEET</h3>
										</div>
									</div>
													<div class="card-body">
										<fieldset class="scheduler-border">
											<legend class="scheduler-border">Employee Details</legend>
											<div class="form-group mb-0">
												<div class="row formline">
													<div class="col-sm-2">
														<label for="emp_id">Employee Id</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="emp_id" name="emp_id"
															th:value="${TimesheetList?.emp_id}"
															class="form-control form-control-sm"  readonly>
													</div>

													<div class="col-sm-2"></div>
													<div class="col-sm-2">
														<label for="employeeName">Employee Name</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="employeeName"
															class="form-control form-control-sm"
															th:value="${TimesheetList?.emp_name}"  readonly/>
													</div>
												</div>

												<div class="row formline">
													<div class="col-sm-2">
														<label for="designation">Year</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="year"
															class="form-control form-control-sm"
															th:value="${TimesheetList?.year}"  />
													</div>
													

													<div class="col-sm-2"></div>
													<div class="col-sm-2">
														<label for="dob">Month</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="month" 
															class="form-control form-control-sm"
															th:value="${TimesheetList?.month}"  />
													</div>
													
												</div>

												<div class="row formline">
													<div class="col-sm-2">
														<label for="doj">Organization</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="organization"
															th:value="${TimesheetList?.orgn_name}"
															class="form-control form-control-sm"  />
													</div>

													<div class="col-sm-2"></div>
													<div class="col-sm-2">
														<label for="location">Location</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="location"
															class="form-control form-control-sm"
															th:value="${TimesheetList?.location}"  />

													</div>
												</div>

												<div class="row formline">
													<div class="col-sm-2">
														<label for="projectName">Project Name</label>
													</div>
													<div class="col-sm-2">

														<input id="projectName"
															class="form-control form-control-sm"
															th:value="${TimesheetList?.proj_name}"readonly>

													</div>

													<div class="col-sm-2"></div>
													<div class="col-sm-2">
														<label for="clientName">Client Name</label>
													</div>
													<div class="col-sm-2">

														<input id="clientName"
															class="form-control form-control-sm"
															th:value="${TimesheetList?.client_name}" >

													</div>
												</div>

												<div class="row formline">
													<div class="col-sm-2">
														<label for="reportManager">Report Manager</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="reportManager"
															class="form-control form-control-sm"
															th:value="${TimesheetList?.rpt_mrg}" readonly />

													</div>

													<div class="col-sm-2"></div>
													<div class="col-sm-2">
														<label for="approvalAuthority">Approval Authority</label>
													</div>
													<div class="col-sm-2">

														<input type="text" id="approvalAuthority"
															th:value="${TimesheetList?.apr_auth}"
															class="form-control form-control-sm"  />

													</div>
												</div>
											</div>
										</fieldset>
<!-- --------------------------------------------	Time Sheet Details ------------------------------------------------------------ -->

										<fieldset >
											<legend>Time Sheet Details</legend>
										<div class="table-responsive mb-4">
												<table class="table table-bordered" id="tab_logic">
														<thead>
															<tr id="taby">
																 <th style="text-align:center;">Date</th >
                                                                 <th style="text-align:center;">Day</th >
                                                                 <th style="text-align:center;">Time In</th >
                                                                 <th style="text-align:center;">Time Out</th >
                                                                 <th style="text-align:center;">Hours</th >
                                                                 <th style="text-align:center;">Job Type</th >
                                                                 <th style="text-align:center;">Job Description</th >
                                                                 <th style="text-align:center;">Holiday Status</th >
															</tr>
														</thead>
													
													</table>
															</div>
										</fieldset>
										
	<!-- <--------------------------------------------------------Submission Details---------------------------------------------------------------------------->


										<div class="container-fluid content">
											<div class="row">
												<div class="col-sm-12 finuserapply">
														<div class="card">

															<fieldset class="scheduler-border">
																<legend>Submission Detailssa</legend>
																<div class="form-group mb-0">
																	<div class="row formline">
																		<div class="col-sm-2">
																			<label for="ts_status">Time Sheet Status</label>
																		</div>
																		<div class="col-sm-3">
																			<input type="text" id="modify_ts_status"name="ts_status"
																				Value="Pending"
																				class="form-control form-control-sm" readonly />
																		</div>
																		<div class="col-sm-1"></div>
																		<div class="col-sm-2">
																			<label for="date_of_submission">Date Of
																				Submission</label>
																		</div>
																		<div class="col-sm-3">
																			<input type="text" id="modify_date_of_submission"name="date_of_submission" onclick="popupscreen();"
																				th:value="${#dates.format(TimesheetList?.date_of_submission,'dd-MM-yyyy')}"
																				class="form-control form-control-sm" />
																		</div>
																	</div>
																</div>
																<div class="form-group mb-0">
																	<div class="row formline">
																		<div class="col-sm-2">
																			<label for="date_of_approval">Date Of Approval</label>
																		</div>
																		<div class="col-sm-3">
																			<input type="text" id="modify_date_of_approval1"name="date_of_approval"
																				th:value="${#dates.format(TimesheetList?.date_of_approval,'dd-MM-yyyy')}"
																				class="form-control form-control-sm" readonly/>
																		</div>
																		<div class="col-sm-1"></div>
																		<div class="col-sm-2">
																			<label for="review_remarks">Approval Remarks</label>
																		</div>
																		<div class="col-sm-3">
																			<input type="text" id="modify_review_remarks"name="review_remarks"
																				th:value="${TimesheetList?.review_remarks}" 
																				class="form-control form-control-sm" readonly/>
																		</div>
																	</div>
																</div>
															</fieldset>
														</div>
												</div>
												</div>

											<div class="card-footer text-center"style="background-color:#BBC3CB;">
												<button type="button" class="btn btn-primary" id="btnHome"
													onclick="home()">Home</button>
												<button type="button" class="btn btn-primary" id="btnsubmit"
												th:attr="data-empid=${TimesheetList?.emp_id},data-month=${TimesheetList?.month},data-year=${TimesheetList?.year}"
													onclick="submitform(this);">Submit</button>
												<button type="button" class="btn btn-primary" id="btnBack"
													onclick="back()">Back</button>
											</div>
										</div>
										</div></div>
							</form>
						</div>
					</div>
				</form>
				</div>
			</div>
		</div>
	</div>

				<div class="container-fluid content"  th:if="${formmode}=='add'OR ${formmode}=='Yes' OR ${formmode}=='addnew'"style="width:1000px;">
					<div class="row">
						<div class="col-sm-12">
						
							<form action="#" th:object="${TimesheetList}" method="POST"
								class="w-100" autocomplete="off" id="timeSheetmaster1">
								<div class="card border-0">
									<div class="card-header">
										<div class="float-left">
											<h3>TIME SHEET</h3>
										</div>
									</div>
									<div class="card-body p-0">
										<fieldset>
											<legend>Employee Details</legend>
											<div class="form-group mb-0">
												<div class="row formline">
													<div class="col-sm-2">
														<label for="year">Year</label>
													</div>
													<div class="col-sm-3" th:if="${formmode}=='add'">

														<select name="year"  id="year" class="form-control" required>
														
									</select>
									</div>
									<div class="col-sm-3" th:if="${formmode}=='Yes'">
										<select name="year" id="dropdownYear1" class="form-control form-control-sm"required>
											<option value="" disabled selected>Year</option>
											<option value="2023">2023</option>
											<option value="2024">2024</option>
											<option value="2025">2025</option>
											<option value="2026">2026</option>
											<option value="2027">2027</option>
											<option value="2028">2028</option>
											<option value="2029">2029</option>
										</select>
									</div>
									<div class="col-sm-3" th:if="${formmode}=='addnew'">
										<select name="year" id="dropdownYear" class="form-control form-control-sm"required>
											
										</select>
									</div>
													<div class="col-sm-1"></div>
													<div class="col-sm-2">
														<label for="month">Month</label>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='add'">
														<select name="month"th:value="${TimesheetList?.month}" id="month" class="form-control"  required>
															
									</select>
									</div>
									<div class="col-sm-3" th:if="${formmode}=='Yes'">
										<select name="month" id="month1"
											class="form-control form-control-sm" required>
											<option value="" disabled selected>Month</option>
											<option value="01">January</option>
											<option value="02">February</option>
											<option value="03">March</option>
											<option value="04">April</option>
											<option value="05">May</option>
											<option value="06">June</option>
											<option value="07">July</option>
											<option value="08">August</option>
											<option value="09">September</option>
											<option value="10">October</option>
											<option value="11">November</option>
											<option value="12">December</option>
										</select>
									</div>
									<div class="col-sm-3" th:if="${formmode}=='addnew'">
										<select name="month" id="dropdownMonth"
											class="form-control form-control-sm" required>
										</select>
									</div>
												</div>
											</div>
											
											<div class="form-group mb-0">
												<div class="row formline">
													<div class="col-sm-2">
														<label for="emp_id">Employee Id</label>
													</div>
													<div class="col-sm-3">
															
														<input type="text" id="add_employee_id" th:value="${session.USERID}"
															class="form-control form-control-sm" name="emp_id"
										z					autocomplete="off" readonly required />
													</div>
													<div class="col-sm-1"></div>
													<div class="col-sm-2">
														<label for="emp_name">Employee Name</label>
													</div>
													<div class="col-sm-3">
														<input type="text"th:value="${session.USERNAME}" id="add_emp_name" name="emp_name"
															class="form-control form-control-sm" autocomplete="false"
															 readonly required/>
														
													</div>
												</div>
											</div>
											
											<div class="form-group mb-0">
												<div class="row formline">
													<div class="col-sm-2">
														<label for="orgn_name">Organization</label>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='add' OR ${formmode}=='Yes'">
														
														<input type="text" id="add_orgn_name"
														th:value="${TimesheetList?.orgn_name}"
															class="form-control form-control-sm" name="orgn_name"
															autocomplete="off" />
													</div>
													<div class="col-sm-3"th:if="${formmode}=='addnew'">
														
														<input type="text" id="add_orgn_name" Value="Bornfire Innovations"
															class="form-control form-control-sm" name="orgn_name"
															autocomplete="off" />
													</div>
													<div class="col-sm-1"></div>
													<div class="col-sm-2">
														<label for="location">Location</label>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='add'OR ${formmode}=='Yes'">
														
														<input type="text" id="add_location"th:value="${TimesheetList?.location}" name="location"
															class="form-control form-control-sm" autocomplete="false"
															  />
													</div>
													<div class="col-sm-3"th:if="${formmode}=='addnew'">
														
														<input type="text" id="add_location" name="location"
															class="form-control form-control-sm" autocomplete="false"
															   />
													</div>
												</div>
											</div>
											<div class="form-group mb-0">
												<div class="row formline">
													<div class="col-sm-2">
														<label for="projectname">Project Name</label>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='add'OR ${formmode}=='Yes'">
															
														<input type="text" id="add_project_name" th:value="${TimesheetList?.proj_name}"
															class="form-control form-control-sm" name="proj_name"
															autocomplete="off" />
													</div>
													<div class="col-sm-3"th:if="${formmode}=='addnew'">
															
														<input type="text" id="add_project_name"
															class="form-control form-control-sm" name="proj_name"
															autocomplete="off"    />
													</div>
													<div class="col-sm-1"></div>
													<div class="col-sm-2">
														<label for="client_name">Client Name</label>

													</div>
													<div class="col-sm-3"th:if="${formmode}=='add'OR ${formmode}=='Yes'">
														
														<input type="text" id="add_client_name"th:value="${TimesheetList?.client_name}" name="client_name"
															class="form-control form-control-sm" autocomplete="false"
															 />
													</div>
													<div class="col-sm-3"th:if="${formmode}=='addnew'">
														
														<input type="text" id="add_client_name"name="client_name"
															class="form-control form-control-sm" autocomplete="false"
															  />
													</div>
												</div>
											</div>
											<div class="form-group mb-0">
												<div class="row formline">
													<div class="col-sm-2">
														<label for="reportmanager">Report Manager</label>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='add'OR ${formmode}=='Yes'">
														
														<input type="text" id="add_report_manager" th:value="${TimesheetList?.rpt_mrg}"
															
															class="form-control form-control-sm" name="rpt_mrg"
															autocomplete="off"  />
																</div>
																<div class="col-sm-3"th:if="${formmode}=='addnew'">
														
														<input type="text" id="add_report_manager"
															class="form-control form-control-sm" name="rpt_mrg"
															autocomplete="off"   />
																</div>
													<div class="col-sm-1"></div>
													<div class="col-sm-2">
														<label for="appauth">Approval Authority</label>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='add'OR ${formmode}=='Yes'">
														
														<input type="text" id="add_app_auth" name="apr_auth"
															th:value="${TimesheetList?.apr_auth}" 
															class="form-control form-control-sm" autocomplete="false"
															/>
													</div>
													<div class="col-sm-3"th:if="${formmode}=='addnew'">
														
														<input type="text" id="add_app_auth" name="apr_auth"
															class="form-control form-control-sm" autocomplete="false"
															 required/>
													</div>
												</div>
											</div>
										</fieldset>
									</div>
							
									<div class="card-footer text-center border-top-0 bg-white"
										style="background-color: unset">
										<button class="btn btn-xs btn-primary" onclick="home(this);"
											id="btnModify">Home</button>
										<button type="button" class="btn btn-xs btn-primary" onclick="fnadd();"
											id="addSubmit">Submit</button>
											
										<button class="btn btn-xs btn-primary" form="userProfile"
											id="btnSubmit" onclick="back();">Back</button>
									</div>
								</div>
								
	</form>
	
						</div>
					</div>
					
				</div>

		
	<div class="modal fade" id="alert">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel" style="text-align: center; color: rgb(0, 0, 0);">BTM MANAGER</div>
				</div>
				<div class="modal-body" style="text-align: center; background-color: #c6ccd2">
					<p id="alertmsg" style="font-size: 16px;"></p>
					<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="back();">Close</button>
				</div>
			</div>
		</div>
	</div> 
	<div class="modal fade" id="alert1">
		<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="menu-header">
				<button type="button" class="close"style="margin-right:10px;: center;" data-dismiss="modal"></button>
					<h4 class="modal-title" style="text-align: center;">BORNFIRE MANAGER</h4>
	
				</div>
				<div class="modal-body" style="text-align: center; background-color: #c6ccd2">
					<p id="alertmsg1" style="font-size: 16px;">Do You Want Change Timesheet Month?</p>
					<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="Yes(this);">Yes</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="AddCurrent();">No</button>
				</div>
			</div>
		</div>
	</div> 

 
</body >
</html>